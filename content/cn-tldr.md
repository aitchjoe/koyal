---
title: Cloud Native TLDR
---

建议配合[*云原生漫谈*](why-here.md) PPT 一起了解。

## What is Cloud Native

云原生的[官方定义](https://github.com/cncf/toc/blob/main/DEFINITION.md#中文版本)：

> *云原生*技术有利于各组织在公有云、私有云和混合云等新型动态环境中，构建和运行可弹性扩展的应用。*云原生*的代表技术包括容器、服务网格、微服务、不可变基础设施和声明式API。
>
> 这些技术能够构建容错性好、易于管理和便于观察的松耦合系统。结合可靠的自动化手段，*云原生*技术使工程师能够轻松地对系统作出频繁和可预测的重大变更。

以上定义中的：

- "有利于"、"易于"、"便于"、"轻松地"等等只是期望达到的目标，显然非云原生专属。
- "微服务"、"不可变基础设施"、"声明式"、"松耦合"、"自动化"等等，都是早已存在的最佳实践。
- 其中最具辨识度也就是"容器"、"服务网格"，而这两个词当然也不是唯一、排他的，不是说用上容器就代表云原生了。

所以云原生并不是一个边界分明、绝对清晰的概念，追根究底既不可能也无必要：

- 将云原生简单理解为**现代的、当前先进的**即可，可以试着用"*现代的*"替换以上定义中的"*云原生*"，是不是读起来更实在。
- 而我们对云原生接纳的**重点**是实现云原生定义中所强调的目标，这也是任何一个 IT 专业人士的追求。
- "原生"这个词代表针对性的设计，那么在当前契合现代云环境的技术自然就是云原生的。
- **如果之前做得专业，并且一直保持着提升，那么现在，就是一个"云原生"应用。**
- 云原生并不是或者不只是一个 Buzzword（时髦词汇、漂亮口号），业界基于容器、Kubernetes 有大量的、不同规模的实际成功案例。当然标榜云原生的失败案例更多，这也是下面会提及的话题。
- 我们在真正落地时，要克制提云原生这个词，我们讨论[容器](container-tldr.md)、[Dockerfile](container-run-tldr.md#dockerfile)，讨论 [Kubernetes](k8s-tldr.md) 和主要的 Object，讨论 [*Helm Chart*](why-here.md) 或 Kustomize，讨论 [Git](git-tldr.md) 工作流和 [CI/CD](cicd-tldr.md)，讨论 Java、Spring 的版本[升级](cn-transform.md#升级)，每掌握一个具体的技术点、每解决一个技术债，我们就离云原生近一点；而如果我们只讨论范范的云原生、数字化，只"聚焦"在业务开发，那也是求仁得仁。

## To Be or Not to Be

很显然按之上对云原生的理解，应不应该、需不需要云原生并不是一个议题，而重点是我们上云原生的**代价**：

- 云平台和云原生应用是相互成就的，没有万能的、不做挑拣跑任何应用的平台；要适配现代的云平台，必须对传统应用做一定甚至很大的技术改造，是否愿意承担这方面的投入？
- 云原生的具体代表技术如 Kubernetes 有较高的进入门槛，无论是平台方还是应用方，是否支持一定比例的专项人力投入？
- 现代云平台讲究的是**自主管理、自助服务**，这实际上就是对平台用户的要求，而让 IT 应用团队在业务开发的同时还有余力提升技术，在人力有限的前提下，则组织机制、需求管控等其他方面总得有所突破。
- 自动化、特别是全面自动化带来的不只是好处，如果发生疏漏产生的后果更严重、更迅疾，甚至是灾难性的，因此要提升的不止是自动化本身，防止、隔离自动化故障的水平也必须有投入、保持同步提升。
- 自动化的提升也会影响到传统的流程管理，因此也需要有决心突破已经设立的流程。
- 现代云的动态性和自动化程度决定了传统的安全措施力有未逮，是否愿意做云原生安全的**技术**投入？
- 技术债：
  - 微服务是否真的拆分成了轻量级的"微"服务？有标准的、语义规范的 API？
  - 对于以微服务为代表的分布式架构，是否已积累了足够的经验或资产？比如分布式追踪。
  - 是否了解不可变基础设施、GitOps 的理念或者已经熟悉相应的工具？
  - 不谈平台的声明式管理，是否已经熟悉或使用 Java 8 就推出的声明式函数编程？
  - 在自动化测试方面是否有足够的积累？这代表着是否真的有信心做技术重构或升级。
  - 实际上是这些**技术债**真正阻止了用户上云，反之如果没有这些技术债，拥抱容器、拥抱 Kubernetes 是一个无需说服、自然而然的反应，其间的跨度或者说学习曲线会低得可以忽略其中的代价。

以上问题是每个决策人最需要考虑的点，但实际上我们经常被问到的是上容器的运行成本：

- ↑ 从技术原理上来讲，容器比 VM 要轻，自然运行成本更低。
- ↑ 从设计上来讲，容器尽量舍弃非必须的依赖或工具，自然比 VM 更轻。
- ↓ 但是对于平台，降低平均成本的关键是规模化，而我们现在的 Kubernetes 平台远小于 VM。
- ↓ 业界对 Kubernetes 人员的需求远高于传统平台，这也决定了人力成本不可能低。

而评估一个大的技术方案或架构，直接成本绝对不是考量的第一位，而必须结合收益特别是中长期的发展来看，换句话说，如果哪个应用真的能达到云原生目标，我相信公司是非常愿意免运行成本来支持的:) 所以现实中的问题仍然是愿不愿意付出、或者付不付得起这些代价：

- 以自动化为例，如果确实投入受限，那么手工或半自动化的操作加上流程管控，要强于半吊子的自动化，这是一个非常务实的选择（这不是反讽）。所以上云原生、或者基于现实条件的不上云原生，这两者**没有优劣**，我们反对的是标榜云原生的既要又要还要。
- 已经做好的系统为什么还要上云？这是我们作为平台方经常受到挑战的一个问题。变更就有风险，变更就需要投入，这个变更竟然没多出一个业务功能，如果局限在这些点上，显然只能得出一个结论；而只谈云原生的好处也没有意义，因为绕不开上面说的那些代价，而这些代价实际是在为未来买单，所以**真正**应该回答这个问题的还是平台用户方的决策人，从公司、部门以及个人的利益和风险出发。

## Cloud Timeline

```
   [1993]The term cloud --------> [2002]Amazon Web Service ---> [2006]Amazon S3 / EC2 ┐
                                                                                      |
┌  [2011]Twelve Factor <- [2010]Continuous Delivery <- [2008]Netflix Cloud Migration <┘
|
└> [2013]Docker ----------------> [2014]Kubernetes --------------> [2015]Spring Cloud ┐
                                                                                      |
┌  [2016]OpenShift 3.3 <------------- [2015]Cloud Native Computing Foundation (CNCF) <┘
|
└> [2017]Kubernetes has won -----> [2018]Our first OpenShift Cluster --------> [2024] ?
```

- 这里想强调的是云已经存在好多年了，它不是一个未来的方向、我们还可以犹豫讨论。
- 现在的云原生做法，实际上在 2010 年 Jez Humble 和 David Farley 著的 [Continuous Delivery](continuous-delivery-notes.md) 就讨论出了大概。
