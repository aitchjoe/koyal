---
title: DevOps Talk
---

[*DevOps 漫谈*](why-here.md)的文字版本，建议通过该 PPT 更直观的了解。

## DevOps

### Dev Vs. Ops

- 开发和运维最直观的矛盾是**求变和求稳**，但相信双方都不可能否定对方的诉求，因此基于各自的优先级（KPI）和资源投入，所产生的实际问题在于**谁都无法满意的协作效率和质量、以及恶化后的团队冲突和信任危机**。
- 对于这个问题场景，DevOps 的解决**不是消除"矛盾"而是消除"双方"**，不再区分开发运维、而是作为一个整体在内部协调。
  - 注意在壁垒分明和浑然一体之间，仍有不同程度不同倾向的中间状态，这也是在真实落地阶段需要做的工程权衡。

### Ops Vs. Infra

- 开发运维一体不是说两者完全合并，因为运维包含了 IaaS 平台等基础设施的搭建运维、以及具体应用的部署运维；到 DevOps 模式，简单说就是**开发方承担自己应用的部署和运维**。
  - 以上两种运维职能，传统常以 Infrastructure team 和 Operations team 来区分。
- 关于 DevOps 模式的**可行性**，到现在（甚至五八十年前），已经有足够的工具和实践支持开发团队较为轻松的承担起这部分"额外"的工作。
  - 当然这部分工作并不是真的额外，以前做不到只是受限于当时的技术条件，谁不希望自主掌控、完全按自己的节奏推进？而现在的 CI / CD 工具和 PaaS 平台至少已扫清了技术上的障碍；与此同时，运维方从这部分工作解脱出来也能更聚焦于平台本身、自动化工具等更有价值和含金量的工作。

### DevOps Vs. CI/CD

- CI/CD 可能是大部分用户对 DevOps 最直观的印象。但如 [CI/CD TLDR](cicd-tldr.md) 所述，如果 CI/CD 指的是工具，那也只是 DevOps 整个链条环节的一小部分。
  > 按我们当前的实施程度，包括对用户 CI Job 的行为分析，以及自动化测试的匮乏等等，**只能说我们用上了 CI/CD 工具，但远未达到 CI/CD 的目标**。
- 考虑到开发团队的自主运维，那么 **Day 2 Ops** 涵盖了容量管理、故障排查、性能调优、备份恢复、安全更新等诸多任务以及所依赖的各种平台服务，这才是本文的**重点**。
  - 当然 CI/CD 也是一个复杂领域，值得另文专门分享。

### Tech Vs. Mgmt

- 当然我们不能只谈技术上带来的好处，要让开发团队心甘情愿的承担新的责任、接受新事物必然会带来的学习成本和新的风险，那么**这种改变不能只是某个团队的**。
- 如果组织上不认可 DevOps 的价值或者没有实质支持，如果运维方在占了"便宜"的同时却并没有提升平台的品质，那就**等同于在鼓励那些不想自主掌控、只希望别人负责的团队**……
- DevOps 一直就不是一个纯技术概念，并非只需要开发和运维人员参与，**管理者不能在机制、文化上缺席**！

### Focus Vs. Excuse 1

- 在推广 DevOps 的过程中最常遇到的是"**我们接受 DevOps，但我们不想学新东西，最好这些能设计得对我们透明**"，而貌似诚恳的挡箭牌就是要聚焦于业务开发。
- 关于这个问题，首先，没有这种好事。如果有，我们自然会引入，如果业界没有而我们自己发明了，你最好确认一下真正得到的是什么？
- 虽然在软件开发上讲究封装、底层实现尽量透明，但是也有很多领域是**不适合**透明处理的。
  - 以缓存为例，就不能简单封装成 POJO 的 Get / Set（真实遇到过的一个开发团队提的需求），因为开发自己必须确定什么样的业务对象适合缓存、缓存键值的设计、Invalidation 的规则等等等等，他们**必须学习**缓存这个领域的基础知识和最佳实践。
  - DevOps、云原生、可观测性等领域亦复如是！必须学习是**前提**，至于程度上是大致了解还是入门或精通，这个强求不来。
- 而且往往也只能保证在正常运行时的透明，一旦出现意外、需要定位故障，总归要了解些底层原理、无法绝对透明的。

### Focus Vs. Excuse 2

- 当然，DevOps 要求开发团队承担更多的责任，并不是反对业务团队聚焦于业务开发，而是说团队聚焦**并不代表**团队的每个人都必须聚焦在业务开发上，否则 PM、开发 Utils 的程序员等等都没有存在的必要了。
  - 服务于业务开发但是和业务没有直接关系的基础工作，无论协作、流程还是 DevOps，在这方面的专人投入需要质疑么？
- 而 DevOps 的另一个侧面，运维方或者更准确的说平台服务的提供方，在从具体应用的运维工作解脱出来的同时，是**有帮助开发团队、引导上手、降低使用成本、解决疑难问题的责任和义务**的，这也能缓解开发团队在这方面投入的压力。
  - 如果运维方做不到，同样代表着 DevOps 的失败，但总归**只是帮助、而非代劳**。

### Focus Vs. Excuse 3

- 强调一下，**即使是业务开发团队，根本上仍是开发、是 IT 而不是业务，学习 IT 新知识天经地义**！
- 聚焦于业务开发，那要不要学 Spring Boot 2 / 3 的新特性？要不要学 Java 11 / 17 的新语法？要不要学 Git 工作流？这些也都不是业务啊；如果说都不愿意那确实也没必要上 DevOps，如果是真的自发主动的愿意学这些，那很难想象会选择性的拒绝学 DevOps 或云原生等。
- 也不要教条的划分是开发还是运维知识，**把一个业务应用真正做好的知识都是有用的知识应该学习的知识**！Git 算开发？GitOps 怎么说？Pod 算运维？听过 DevPod 吗？实际上容器发展初期主要是解决开发环境一致性问题的，也没见开发先引入再教运维呀 ┑(￣Д ￣)┍
- 对于坚持只"聚焦"在业务开发的团队，其实我们可以公开 Review 一下纯开发的代码，看看到底作得有多好？**可以理解现实状况，仅仅完成业务需求就精疲力竭、实在无力考虑更多，但请不要拿"聚焦业务"当挡箭牌**。
- 无论如何，**只追求技术不一定能开发出好的业务应用，但是逃避技术、只"聚焦"在业务开发，是绝对开发不出好的业务应用**！

### DevOps Vs. Platform

- 前面讨论的不应该拿"聚焦业务"当借口，并不是说要把压力全给到开发团队一边，下一节的重点就是平台方 / 运维方要做的改变或革命。
  - 至少我们 [*PaaS 团队*](why-here.md)是这样要求自己的。
- 考虑到我们的现实条件，每个开发团队配熟悉（还不是精通）数个领域的技术人员过于理想化，因此在真正落地时或者采用 BP 模式、或者有倾斜投入等，这些都可以讨论，包括更新的开发者门户、平台工程等，**本质上都是在弥合开发和运维的鸿沟**。
  - 在 DevOps 之前，一样也有开发团队要不要配熟悉共性技术问题的架构师的考虑，这个困境自古有之。

## 平台

### 什么不是平台

- 不是名字叫平台就真的是平台、叫云就真的是云。
- [*云产品技术雷达 2025-01*](why-here.md) 是基于先前新云调研的数据做的一个仿 Thoughtworks 评估，分真正的云、真正的平台、只是一个跑起来的系统和欠缺这四个层次，大家直观感受一下。

随后的讨论我们统一用云的标准要求所有的平台产品和服务，相对传统平台，云本就是更先进的现代平台。

### 什么是先进的、现代的平台

- 平台面向的是具有共性需求的全体用户，平台的高度决定了用户能到达的上限，因此**脱离品质谈平台没有意义**；如果舍弃上面的限定词，那个个都是云平台。
- 说句难听的，**谈 DevOps 不提平台品质就是耍流氓**！"聚焦"业务回避 DevOps 不想自主解决技术问题的也是。
- 退五步说，即使 DevOps 是教条的，即使大部分用户只能"聚焦"在业务，我们仍希望平台是 [*XaaS*](why-here.md) 的，给有追求和余力的其他用户更大的空间！我本人谨代表这类用户。

### 非典型评判标准

- **权威**：至少在公司内部，当用户需要某领域服务支持时，能够马上想起唯一的平台方，而不是 SSO-1 或 SSO-2 还有 SSO-3，不能 Single 成了多点，不是叫统一平台的就真统一了唯一了。
- **名正言顺**：本质同上但这里更强调明确的组织授权。初期赛马可以理解，在平台方没有余力的情况下用户牵头做一个细分领域也很正常，但总不能一直晒下去……否则要么没权威，要么把一个技术平台活生生的做成了业务应用。
- **舍我取谁**：本质同上上。不止用户能想到应该你做，平台方自己也要有这就应该我做的气势，要主动宣导，而不是藏着掖着甚至找上门了都往外推（真事）。
- **全体用户**：开放给有合理需求的全体用户应该算"平台"这个词的基本属性吧？但事实是真有几个解决了用户痛点的平台我们想用用不了 :(
- **升级换代**：如果不持续跟进本领域的发展趋势，那十年前叫平台，现在就只能叫 Legacy 了。
- **惩罚机制**：平台通常是用户[共享](k8s-logging.md)的，很多情况也只能软隔离而非硬隔离，平台方有责任引导用户更好的使用，但对异常用户也不想一直苦口婆心下去。
- **生产 Vs. 正式**：有些平台混淆了这两者，认为不在生产环境就不是正式用途，典型如 LDAP。
- **Sandbox / Playground**：有些领域让用户自行搭建尝试的成本很高，比如 OpenShift，因此提供方便用户接触的试验场应该是平台方的自觉。

### 典型的平台需求

- CI/CD 是 DevOps 最直观的平台服务，但如前所述只是一小部分，可以参考号称一站式 DevOps 平台的 [GitLab](https://gitlab.cn/stages-devops-lifecycle/) 提供的功能集。
- 一个应用会有各式各样的依赖，IaaS / PaaS、数据库等各类中间件、LB / Gateway、安全、监控 / 可观测性等等等等，自然这些依赖所属的平台服务就是应用自助运维的基础，而业界认证的、典型的平台需求在[*新云参考实现*](why-here.md)中有完整说明。

## 行为守则

### 平台和平台用户

- 平台和平台用户是**相互成就**的，有什么样的用户就会得到什么品质的平台。
  - **DevOps 的核心精神是用户要尽可能独立自主的解决问题**、起码也要定位问题出在应用侧还是平台侧。如果用户抗拒 DevOps（不是场面上的 DevOps、是真正的 DevOps 行为要求）、只希望有人代劳，那么自然对现代平台所提供的自主管理、自助服务无感，自然就无所谓 XaaS 了。
  - 如果一个号称平台的东西仍不具备上述现代特性，根本原因是没用户推动、**主要责任在用户**。
  - 如果用户决策方只希望得到一个白菜价的平台，而毫不关心诸如 K8s 的先进性或者对这方面的收益毫无信心，那么确实也能得到一个**白菜价**的结果。
- 平台人员本身的**理念、格局**同样会影响到平台的高度。
  - 如果平台支持人员对处理事务申请类的工作乐此不疲，能够"一年的工作经验重复了十年"，年终的绩效汇报是这年又处理了 xxxx 笔……那自然理解不了另一类人觉得这是在消磨生命、一定要提升平台、要用自动化 / XaaS 武装平台的冲动。

### 平台支持的边界 1

- 平台支持有义务做什么、不需要承担什么？也就是**划分平台支持的边界，这是需要尽早梳理澄清的**。个人认为这是平台能够持续良性发展的一个前提，毕竟不止是开发缺人。
  - 厘清边界的另一个好处就是能倒推平台真正重要、真正应该做的是什么，反之**边界混淆则很容易让双方都有借口逃避难做但更应该做的事**。
- 在平台用户本身就是 IT 人员的前提下，一个最基本的边界就是用户不能连最起码的尝试都没有、不过脑子上来就让平台方去解决，**这是不对的**！！！我们亟需形成这样的氛围。
  - 我们乐意花大量心血创作 [How to Ask for Help](how-to-ask-for-help.md) 这篇文档，指导用户怎样排查问题、定位相关方，但不愿意处理哪怕能顺手解决的低级求助。
  - **求助的第一步是自助**，求助不是事务申请。
  - 我觉得训练用户养成良好习惯也应该算一个平台职责。

### 平台支持的边界 2

个人认为现状是**一些平台方做了很多该用户自己做的事、而该平台负责到底的一些事却又被有意无意的忽视**。这里不谈大的 XaaS 之类，只举两个可能大家习以为常但个人还想较真的例子，完整的边界梳理不是这篇文章能够覆盖的，留待专家组罢。

- 最近遇到的一个案例是某服务由于外部因素出现问题，内部平台方定位不是自己的责任后就无动于衷了。但我认为无论如何，用户是在用这个内部服务时遇到的问题，平台方是有责任去进一步尝试解决的，无论直接间接方式。这件事最后也逼着绕过去了，我并没有也不可能要求必须解决，这里的重点是**用户反感的是"自己不用不着急"的心态**，希望的也只是平台方真的有努力尝试了这个诚意。
  - **平台提供方不是自己平台的用户，管理制度方不用承担相应的成本代价……不能感同身受是很多矛盾的根源**，是有人都"[bang their heads against this wall](twitter-notes.pdf)"了还奇怪"你这么激动干啥"。
- 平台支持文档能够持续更新，有众所周知的权威发布处，旧文档有废弃申明等等。如果用户照着文档用错，不能用"他没问我啊"推卸责任。
  - 很显然现状没这么理想，现实有太多限制，存在即合理，但不代表它天经地义就是对的，在这类重要不紧急的事上投入了心血的**不应该**被轻视！

### 平台支持的边界 3

- 再讨论一个复杂场景，以 Prometheus 监控为例：
  - 监控团队应该更熟悉 PromQL 以及 Dashboard 的制作。
  - 用户团队应该更理解自己领域 Metrics 的含义。
- 监控团队的职责是提供运行 PromQL、展现 Dashboard 的监控平台，而写 PromQL、制作 Dashboard 是对自身需求更理解的开发团队自己的事，这和写 SQL、制作 Report 不找数据库团队是一样的道理。
  - 就这么顺理成章的事，实际情况却是监控团队承担了这种事务性工作。能想到的理由包括 PromQL 毕竟不像 SQL 普及、不写 SQL 应用跑不起来但不监控也可以将就……但即使能理解，当监控全面铺开，除了极少数共性指标共性 Dashboard，监控团队绝无可能让所有团队满意，无论效率还是准确性（对各领域指标的理解）。
  - 但再顺理成章，PromQL / Dashboard 加大开发团队的负担也是事实，如果无法增加人力投入，又应该怎么解决？
- 显然远不止监控会有这个**困境**，比如 PaaS 平台要不要帮用户做云原生改造？帮到什么程度？即使不可能将所有边界完全厘清，除能够做到的部分（如求助）外，只将可能扯皮的部分明确的凸显出来，这也有很大意义。

### 减负 1

- 无论前面的道理多正确，回到现实，DevOps 是实实在在给开发团队增加了负担，因此平台方的一个**重要职责**是尽可能降低用户使用平台的复杂度。
  - 注意这里的用户不止是开发，一个平台的运维人员同样可能是另一个平台的用户，从这个角度讲，**并没有特别委屈谁**。
- 在**降低用户心智负担或者说提升平台易用性**这个目标上，我和同事没有任何分歧，但在具体实施上，我坚持"门槛仍高但没有天花板"、而大多数实际采取的是"门槛很低但天花板明显"的做法。
  - 裁剪：市场上的产品必然希望涵盖尽可能多的客户场景，因此我们拿来使用时通过裁剪减少选项或选择组合，自然对用户更友好，这件事本身也无分歧，分歧在度上，"只裁剪内部绝无可能的选项" Vs. "尽可能压缩用户场景极度简化只保留基本选项"。
  - 封装：下一节展开。
  - 图形界面：个人倾向于在运维中尽可能使用 CLI 方式以方便自动化，不反对 GUI 但认为应该是从属地位。
  - 以上没有对错，关键还是取决于用户的短期长期考量。
- **是减负，不是无负**。

### 减负 2

- 封装是减轻用户负担最典型的一种方法，在这一点上当然也不会有分歧，有争议的地方如下。
- 封装形式：现在常见的是提供 GUI 供用户选择输入，然后翻译成底层的具体实现。可以将这种做法看成发明了一种新的 DSL，而个人倾向仍然基于底层实现的原生形式做定制。
- 谁来封装：封装这个词代表着**抽象、提炼**，这就意味着对做这件事的人要求**极高**；而封装也不是一劳永逸的，底层实现也会持续进化、甚至有新的方案取而代之；封装还需要考虑文档等等，即使底层实现已经有了足够专业完整的文档和社区。这种种难度决定了本人对内部做这件事没有太大信心。
  - 有真实案例。总之深刻认识到封装复杂性的人不愿意轻易封装，而做封装的人……可能也有苦衷吧。
  - 我的观点是业界实际上也在一层一层的做封装，因为大家同样都有减负的需求，在业界还未出现一个基本成气候的封装前，个人的建议是等，先用着原生的（裁剪也可以看成广义的封装，这个可以做）。
- 不同领域不同场景的封装形式封装难度并不相同，所以这些也不是定论，只能拿开发打个比方，我们可以做 Library，但没资格做 Framework / DSL，这个也可以看成封装的程度。- 不要过度封装。

### 持续进化

- 对于 IT 非核心竞争力的企业，IT 工作是从零到一易、从一到十难。
  - 我们可以细数一下，所有平台除了用户数量的增长外到底还做了些什么？
- 具体到每一个平台或应用，不动都可以理解甚至是合理的，但是从全局考量，小心"**赢了每一场战斗、但输掉了整个战争**"。
  - 同前理，如果平台一直不动却一直没有干扰到用户，责任在用户。不是只有干扰应用运行才叫干扰，干扰到用户用新功能新特性也叫干扰。
- 平台不出事最重要，但变成唯一重要就很悲哀了……
- Kubernetes TLDR 的 [Change](k8s-tldr.md#change) 一节有详细讨论。

### PaaS 团队行为守则

1. 不能只搭平台，用户用错了就让他自己负责。
2. 给用户提供的解决方案必须是具体的、可落地的方案，不能是范范的一句做到云原生就行。
3. 说服用户不能只谈原则而不讲具体技术，以专业水平服人。
4. 要引导用户适应新形势，而不是坐等被用户引导。要提前预研，不能说我懂容器就行，起码几种主流的如 Spring Boot、Vue 怎么做容器相关的改造是我们自己应该掌握的。
5. 除了少数用户屡教屡犯的错误，即使是用户疏忽或者大多数用户都容易重犯所造成的事故，我们也要反思平台设计的问题、承担间接责任。
6. 我们做不到完美，但是要分清应不应该做和难不难做，不能想当然的把难做当成了不做，现在做不到也不代表将来做不到，要持续关注。
7. 自动化能消除很多争议，当然自动化也很难做。
8. 要尽力争取组织、领导的支持，但是领导的主要职责是管理、识人、协调资源，而不是替我们做专业判断。
9. 但这并不表示对用户要一味的妥协，参见 [How to Ask for Help](how-to-ask-for-help.md) 及[*黑名单*](why-here.md)。

*感谢某某部的贡献，"每与操反，事乃可成"*。

## 生态

### DevXOps

- DevSecOps 简单说就是 Sec 不再是一个高高在上只出管理制度的角色，必须要加入进 DevOps 的环节干脏活累活，在实践中真正深刻体会"**做安全并不是一味的强求安全、总归要综合考虑安全的成本和代价**"。
- DevFinOps 关注在软件开发生命周期中的财务责任和成本优化，不过现代云平台本来就对容量监控计价有很高的要求。
  - 但一定要**警惕**只有财务成本算成本。

### 平台工程及内部开发者平台

- 主要想解决的是 DevOps 模式中**开发团队负担过重**的问题。
  - 当然解决方式**绝不是**退回到以前状态。
  - 如果将 DevOps 看作狭义的 CI/CD，那么可以把平台工程 / 开发者平台看作前面讨论的平台侧问题。
  - 本质上仍是之前讨论的自助服务、减负的思路，初步尝试感觉还在 Buzzword 阶段，即使已经有先进技术企业真正使用，个人对成熟度的判断是在传统企业 IT 也成规模的用了起来。
- 再回过头来，什么是先进的、现代的平台？方便 DevOps、努力的持续的降低用户负担的平台就是好平台！

### 人

无论开发人员还是运维人员甚至非技术的 IT 从业者，都建议了解的知识：

- Linux 基本命令。
- 容器基础知识。
- Java hello world 编码、编译及运行。
  - 很多时候运维人员都分不出问题出在平台侧还是应用侧，即使从功利的角度也应该学些编程、懂拒绝。
- SQL 主要是 DML。
- Git 及基本工作流。
- Markdown。
- 搜索技巧或 AI 问答、验证真伪的技巧。
- 技术英语。

Vs：

> 只是为了生存而不得不做的工作，但却被要求不断成长，真的烦死了啊啊啊

## 终

### TLDR

- 开发要做运维，运维要做好平台。
- 知识不分开发运维，没余力学 ≠ 不用学不应该学。
- 做好业务应用的前提是做好 IT 技术。
- 平台方有责任帮助用户减负，但减负 ≠ 无负、帮助 ≠ 代劳。
- 没有委屈开发，实际上一视同仁的针对了所有平台用户。
- 平台和平台用户是相互成就的。
- 更倾向 DevOps 是个文化概念，但只能长在坚实的技术基础之上。
- 开发运维不是敌人，弥合双方鸿沟需要三方的共同努力。

### 求其上，得其中
